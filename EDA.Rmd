---
title: "EDA"
author: "Likhitha, Paulina, Shrihan"
date: "2023-10-10"
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
---


```{r, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)
options(scientific=T, digits = 3) 
library(ezids)
library(ggplot2)
#install.packages("tigris")
library(tigris)
#install.packages("sf")
library(sf)
#install.packages("here")
library(here)
#install.packages("dply")
library(dplyr)
#install.packages("leaflet")
library(leaflet)
#install.packages("reshape2")
library(reshape2)


```



**Load the data file**

```{r Load the data file }



#SVI_Data <- read.csv('C:/Users/lkg31/OneDrive/Desktop/DATS-6101-PROJECT/SVI_2020_US.csv')

#We can here() to construct the path relative to the project directory, so we can each read it in each time 

SVI_Data <- read.csv("SVI_2020_US.csv")
head(SVI_Data)



```

**** NOTE: -999 is input for missing data, should we remove the tracts that have -999 in the RPL_THEME1,2,3,4,RPL_THEMES columns?*****
*** FOR MAPPING, I HAVE REMOVED THE MISSING DATA***

**Remove irrelevant columns**

```{r select columns}

#selecting the required columns by subset function
Clean_data <- subset(SVI_Data, select = c(ST,STATE,ST_ABBR,STCNTY,COUNTY,FIPS,LOCATION,AREA_SQMI,EPL_POV150,	EPL_UNEMP,	EPL_HBURD,	EPL_NOHSDP,	EPL_UNINSUR,	SPL_THEME1,	RPL_THEME1,	EPL_AGE65,	EPL_AGE17,	EPL_DISABL,	EPL_SNGPNT,	EPL_LIMENG,	SPL_THEME2,	RPL_THEME2,	EPL_MINRTY,	SPL_THEME3,	RPL_THEME3,  EP_HISP, EP_ASIAN, EP_AIAN, EPL_MUNIT,	EPL_MOBILE,	EPL_CROWD,	EPL_NOVEH,	EPL_GROUPQ,	SPL_THEME4,	RPL_THEME4,	SPL_THEMES,	RPL_THEMES
) )

summary(Clean_data)

xkablesummary(Clean_data, title="Clean summary of the data.")

```

**Subset to California** 

```{r}
#subset Clean_Data to just CA tracts
CA_SVI <- subset(Clean_data, ST_ABBR == "CA")
```



**Show Outliers**
```{r}
#Display the Outliers in the cleaned data

Outliers1 = outlierKD2(CA_SVI, RPL_THEME1, rm = FALSE, qqplt = TRUE)
Outliers2 = outlierKD2(CA_SVI, RPL_THEME2, rm = FALSE, qqplt = TRUE)
Outliers3 = outlierKD2(CA_SVI, RPL_THEME3, rm = FALSE, qqplt = TRUE)
Outliers4 = outlierKD2(CA_SVI, RPL_THEME4, rm = FALSE, qqplt = TRUE)
Outliers = outlierKD2(CA_SVI, RPL_THEMES, rm = FALSE, qqplt = TRUE)

```

## Making Maps {.tabset}
### Load, Clean, and Merge 
```{r}
# Load the 2020 Census Tract shapefile for California
ca_tracts <- tracts(state = "CA", year = 2020)
```

```{r}

#add 0 to FIPS in CA_SVI to merge with ca_tracts

CA_SVI$FIPS <- paste0("0", CA_SVI$FIPS)

```

```{r}
#make a join of CA_SVI and ca_tracts based on FIPS and GEOID
CA_SVI <- inner_join(CA_SVI, ca_tracts, by = c("FIPS" = "GEOID"))

```

```{r}
#for mapping, convert CA_SVI to a SF 
ca_svi_sf <- st_as_sf(CA_SVI)
```
### RPL THEME Overall
Notice, the tracts are all labeled as high risk. There isn't really anything to observe. 
```{r}
#interactive map of RPL_THEMES

# Remove rows with -999 in the RPL_THEMES column

ca_svi_sf_clean <- subset(ca_svi_sf, RPL_THEMES != -999)


color_pal <- colorNumeric(
  palette = "OrRd", domain = ca_svi_sf_clean$RPL_THEMES
)

themes_map <- leaflet() %>%
  addTiles() %>%
  addPolygons(data = ca_svi_sf_clean,
              fillColor = ~color_pal(RPL_THEMES),
              fillOpacity = 0.5,
              color = "black",
              weight = 1,
              popup = ~as.character(RPL_THEMES)) %>%
  setView(lng = -119.417931, lat = 36.778261, zoom = 6)  # Set the initial view

# Display the map
themes_map

```

### RPL THEME 1
```{r}
#interactive map of RPL_THEME1

# Remove rows with -999 in the RPL_THEME1 column

ca_svi_sf_clean <- subset(ca_svi_sf, RPL_THEME1 != -999)


color_pal <- colorNumeric(
  palette = "YlOrRd", domain = ca_svi_sf_clean$RPL_THEME1
)

theme1_map <- leaflet() %>%
  addTiles() %>%
  addPolygons(data = ca_svi_sf_clean,
              fillColor = ~color_pal(RPL_THEME1),
              fillOpacity = 0.5,
              color = "black",
              weight = 1,
              popup = ~as.character(RPL_THEME1)) %>%
  setView(lng = -119.417931, lat = 36.778261, zoom = 6)  # Set the initial view

# Display the map
theme1_map

```

### RPL THEME 2

```{r}
#interactive map of RPL_THEME2

# Remove rows with -999 in the RPL_THEME2 column

ca_svi_sf_clean <- subset(ca_svi_sf, RPL_THEME2 != -999)


color_pal <- colorNumeric(
  palette = "magma", domain = ca_svi_sf_clean$RPL_THEME2
)

theme2_map <- leaflet() %>%
  addTiles() %>%
  addPolygons(data = ca_svi_sf_clean,
              fillColor = ~color_pal(RPL_THEME2),
              fillOpacity = 0.5,
              color = "black",
              weight = 1,
              popup = ~as.character(RPL_THEME2)) %>%
  setView(lng = -119.417931, lat = 36.778261, zoom = 6)  # Set the initial view

# Display the map
theme2_map

```

### RPL THEME 3

```{r}
#interactive map of RPL_THEME3

# Remove rows with -999 in the RPL_THEME3 column

ca_svi_sf_clean <- subset(ca_svi_sf, RPL_THEME3 != -999)


color_pal <- colorNumeric(
  palette = "Reds", domain = ca_svi_sf_clean$RPL_THEME3
)


theme3_map <- leaflet() %>%
  addTiles() %>%
  addPolygons(data = ca_svi_sf_clean,
              fillColor = ~color_pal(RPL_THEME3),
              fillOpacity = 0.5,
              color = "black",
              weight = 1,
              popup = ~as.character(RPL_THEME3)) %>%
  setView(lng = -119.417931, lat = 36.778261, zoom = 6)  # Set the initial view

# Display the map
theme3_map

```

### RPL THEME 4

```{r}
#interactive map of RPL_THEME4

# Remove rows with -999 in the RPL_THEME4 column

ca_svi_sf_clean <- subset(ca_svi_sf, RPL_THEME4 != -999)


color_pal <- colorNumeric(
  palette = "RdPu", domain = ca_svi_sf_clean$RPL_THEME4
)

theme3_map <- leaflet() %>%
  addTiles() %>%
  addPolygons(data = ca_svi_sf_clean,
              fillColor = ~color_pal(RPL_THEME4),
              fillOpacity = 0.5,
              color = "black",
              weight = 1,
              popup = ~as.character(RPL_THEME3)) %>%
  setView(lng = -119.417931, lat = 36.778261, zoom = 6)  # Set the initial view

# Display the map
theme3_map

```


**Correlation HeatMap**


```{r}

# creating correlation matrix
correlation_matrix <- cor(CA_SVI[, c("EPL_POV150", "EPL_UNEMP", "EPL_HBURD", "EPL_NOHSDP", "EPL_UNINSUR","EPL_AGE65", "EPL_AGE17", "EPL_DISABL", "EPL_SNGPNT", "EPL_LIMENG","EPL_MINRTY", "EPL_MUNIT", "EPL_MOBILE", "EPL_CROWD", "EPL_NOVEH","EP_HISP", "EP_ASIAN", "EP_AIAN", "SPL_THEME1", "SPL_THEME2","SPL_THEME3", "SPL_THEME4", "SPL_THEMES","RPL_THEME1", "RPL_THEME2", "RPL_THEME3", "RPL_THEME4")])

correlation_melted <- melt(correlation_matrix)

ggplot(correlation_melted, aes(Var1, Var2, fill = value)) +
  geom_tile() +
  scale_fill_gradient(low = "red", high = "green") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) + # Rotate x-axis labels
  labs(title = "Correlation Heatmap of SVI Variables and Demographics")


```
**Scatter Plot of SPL_THEMES(Total SVI) and SPL_THEME4((Housing & Transportation))**

```{r}

CA_SVI <- subset(CA_SVI,  SPL_THEME4!= -999 )
CA_SVI <- subset(CA_SVI,  SPL_THEMES!= -999 )
CA_SVI1 <- subset(head(CA_SVI, 8000))




ggplot(CA_SVI, aes(x = SPL_THEMES, y = SPL_THEME4, color=COUNTY)) +
  geom_point() +
  labs(x = " Total Svi score", y = "SPL_THEME4(Housing Type & Transportation)") +
  ggtitle("SPL_THEMES VS SPL_THEME4")



```
**Scatter Plot of SPL_THEMES(Total SVI) and EP_HISP(population of Hispanic)**

```{r}
library(ggplot2)


CA_SVI <- subset(CA_SVI,  EP_HISP!= -999 )
CA_SVI <- subset(CA_SVI,  SPL_THEMES!= -999 )
CA_SVI<-subset(head(CA_SVI,4000))





ggplot(CA_SVI, aes(x = EP_HISP, y = SPL_THEMES, color=COUNTY)) +
  geom_point() +
  labs(x = " Percent of Hispanic", y = "SPL_THEMES(Total SVI)") +
  ggtitle("Social Vulnerability vs Hispanic Population")

```
**Scatter Plot of SPL_THEME1(Socioeconomic Status) and EP_NOHSDP (Percent of the population with no high school diploma)**

```{r}

library(ggplot2)


CA_SVI <- subset(CA_SVI,  EPL_NOHSDP!= -999 )
CA_SVI <- subset(CA_SVI,  SPL_THEME1!= -999 )






ggplot(CA_SVI, aes(x = EPL_NOHSDP, y = SPL_THEME1, color=COUNTY)) +
  geom_point() +
  labs(x = "  Percent of the population with no high school diploma", y = "SPL_THEME1(Socioeconomic Status)") +
  ggtitle("Scatterplot of Educational Attainment and Social Vulnerability")



```

```{r}
library(ggplot2)


CA_SVI <- subset(CA_SVI,  EPL_AGE65!= -999 )
CA_SVI <- subset(CA_SVI,  SPL_THEMES!= -999 )






ggplot(CA_SVI, aes(x = EPL_AGE65, y = SPL_THEMES, color=COUNTY)) +
  geom_point() +
  labs(x = "Percent of the population age 65 and older", y = "SPL_THEMES(Total SVI)") +
  ggtitle("AGE VS Total SVI")



```

**Top 10 Counties with highest SVI**

```{r}
county_svi <- CA_SVI1 %>%
  group_by(COUNTY) %>%
  summarize(mean_SVI = mean(SPL_THEMES)) %>%
  ungroup()

# Select the top 10 counties with the highest mean SVI
top_10_counties <- county_svi %>%
  top_n(10, wt = mean_SVI)

# Create a histogram of the mean SVI for the top 10 counties
histogram_plot <- ggplot(data = top_10_counties, aes(x = reorder(COUNTY, -mean_SVI), y = mean_SVI)) +
  geom_bar(stat = "identity", fill = "skyblue", color = "blue", alpha = 0.7) +
  
  # Label the axes and add a title
  labs(x = "County", y = "Mean SPL_THEMES (SVI)", title = "Top 10 Counties with High SVI") +
  
  # Customize the appearance
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5))  # Rotate x-axis labels for better readability

# Display the histogram
print(histogram_plot)

```




```{r}
#Initial Histogram for variables
ggplot(CA_SVI, aes(x = SPL_THEMES)) +
  geom_histogram(aes(y=..density..),binwidth=0.09, fill="#00008B", color="#000000", alpha=0.7)+
geom_density(alpha=.5, fill="yellow") + 
  labs(x = " SPL_THEMES", y = "density") +
  ggtitle("Histogram of SPL_THEMES")

ggplot(CA_SVI, aes(x = RPL_THEMES)) +
  geom_histogram(aes(y=..density..),binwidth=0.025, fill="#00008B", color="#000000", alpha=0.7)+
  geom_density(alpha=.5, fill="yellow") + 
  labs(x = " RPL_THEMES", y = "density") +
  ggtitle("Histogram of RPL_THEMES")

ggplot(CA_SVI, aes(x = RPL_THEME1)) +
  geom_histogram(aes(y=..density..),binwidth=0.05, fill="#00008B", color="#000000", alpha=0.7)+
  geom_density(alpha=.5, fill="yellow") + 
  labs(x = " RPL_THEME1", y = "density") +
  ggtitle("Histogram of Socioeconomic status variable i.e RPL_THEME1")

ggplot(CA_SVI, aes(x = RPL_THEME2)) +
  geom_histogram(aes(y=..density..),binwidth=0.05, fill="#00008B", color="#000000", alpha=0.7)+
  geom_density(alpha=.5, fill="yellow") + 
  labs(x = " RPL_THEME2", y = "density") +
  ggtitle("Histogram for Household characteristics variable i.e RPL_THEME2")

ggplot(CA_SVI, aes(x = RPL_THEME4)) +
  geom_histogram(aes(y=..density..),binwidth=0.05, fill="#00008B", color="#000000", alpha=0.7)+
  geom_density(alpha=.5, fill="yellow") + 
  labs(x = " RPL_THEME3", y = "density") +
  ggtitle("Histogram for Housing type and Transportation variable i.e RPL_THEME4 ")

```


```{r}
library(scatterplot3d)
attach(trees)
scatterplot3d(, Height, Volume, pch = 20, highlight.3d = TRUE,
+ type = "h", main = "3D Scatterplot of trees dataset")











