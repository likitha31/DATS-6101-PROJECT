---
title: "EDA"
author: "Likhitha, Paulina, Shrihan"
date: "2023-10-10"
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
---


```{r, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)
options(scientific=T, digits = 3) 
library(ezids)
library(ggplot2)
#install.packages("tigris")
library(tigris)
#install.packages("sf")
library(sf)
#install.packages("here")
library(here)
#install.packages("dply")
library(dplyr)
#install.packages("leaflet")
library(leaflet)

```



**Load the data file**

```{r Load the data file }


=======
#SVI_Data <- read.csv('C:/Users/lkg31/OneDrive/Desktop/DATS-6101-PROJECT/SVI_2020_US.csv')

#We can here() to construct the path relative to the project directory, so we can each read it in each time 

SVI_Data <- read.csv(here("SVI_2020_US.csv"))



```

**** NOTE: -999 is input for missing data, should we remove the tracts that have -999 in the RPL_THEME1,2,3,4,RPL_THEMES columns?*****
*** FOR MAPPING, I HAVE REMOVED THE MISSING DATA***

**Remove irrelevant columns**

```{r select columns}

#selecting the required columns by subset function
Clean_data <- subset(SVI_Data, select = c(ST,STATE,ST_ABBR,STCNTY,COUNTY,FIPS,LOCATION,AREA_SQMI,EPL_POV150,	EPL_UNEMP,	EPL_HBURD,	EPL_NOHSDP,	EPL_UNINSUR,	SPL_THEME1,	RPL_THEME1,	EPL_AGE65,	EPL_AGE17,	EPL_DISABL,	EPL_SNGPNT,	EPL_LIMENG,	SPL_THEME2,	RPL_THEME2,	EPL_MINRTY,	SPL_THEME3,	RPL_THEME3,	EPL_MUNIT,	EPL_MOBILE,	EPL_CROWD,	EPL_NOVEH,	EPL_GROUPQ,	SPL_THEME4,	RPL_THEME4,	SPL_THEMES,	RPL_THEMES
) )

summary(Clean_data)

xkablesummary(Clean_data, title="Clean summary of the data.")

```

**Subset to California** 

```{r}
#subset Clean_Data to just CA tracts
CA_SVI <- subset(Clean_data, ST_ABBR == "CA")
```



**Show Outliers**
```{r}
#Display the Outliers in the cleaned data

Outliers1 = outlierKD2(CA_SVI, RPL_THEME1, rm = FALSE, qqplt = TRUE)
Outliers2 = outlierKD2(CA_SVI, RPL_THEME2, rm = FALSE, qqplt = TRUE)
Outliers3 = outlierKD2(CA_SVI, RPL_THEME3, rm = FALSE, qqplt = TRUE)
Outliers4 = outlierKD2(CA_SVI, RPL_THEME4, rm = FALSE, qqplt = TRUE)
Outliers = outlierKD2(CA_SVI, RPL_THEMES, rm = FALSE, qqplt = TRUE)

```

## Making Maps {.tabset}
### Load, Clean, and Merge 
```{r}
# Load the 2020 Census Tract shapefile for California
ca_tracts <- tracts(state = "CA", year = 2020)
```

```{r}

#add 0 to FIPS in CA_SVI to merge with ca_tracts

CA_SVI$FIPS <- paste0("0", CA_SVI$FIPS)

```

```{r}
#make a join of CA_SVI and ca_tracts based on FIPS and GEOID
CA_SVI <- inner_join(CA_SVI, ca_tracts, by = c("FIPS" = "GEOID"))

```

```{r}
#for mapping, convert CA_SVI to a SF 
ca_svi_sf <- st_as_sf(CA_SVI)
```
### RPL THEME Overall
Notice, the tracts are all labeled as high risk. There isn't really anything to observe. 
```{r}
#interactive map of RPL_THEMES

# Remove rows with -999 in the RPL_THEMES column

ca_svi_sf_clean <- subset(ca_svi_sf, RPL_THEMES != -999)


color_pal <- colorNumeric(
  palette = "OrRd", domain = ca_svi_sf_clean$RPL_THEMES
)

themes_map <- leaflet() %>%
  addTiles() %>%
  addPolygons(data = ca_svi_sf_clean,
              fillColor = ~color_pal(RPL_THEMES),
              fillOpacity = 0.5,
              color = "black",
              weight = 1,
              popup = ~as.character(RPL_THEMES)) %>%
  setView(lng = -119.417931, lat = 36.778261, zoom = 6)  # Set the initial view

# Display the map
themes_map

```

### RPL THEME 1
```{r}
#interactive map of RPL_THEME1

# Remove rows with -999 in the RPL_THEME1 column

ca_svi_sf_clean <- subset(ca_svi_sf, RPL_THEME1 != -999)


color_pal <- colorNumeric(
  palette = "YlOrRd", domain = ca_svi_sf_clean$RPL_THEME1
)

theme1_map <- leaflet() %>%
  addTiles() %>%
  addPolygons(data = ca_svi_sf_clean,
              fillColor = ~color_pal(RPL_THEME1),
              fillOpacity = 0.5,
              color = "black",
              weight = 1,
              popup = ~as.character(RPL_THEME1)) %>%
  setView(lng = -119.417931, lat = 36.778261, zoom = 6)  # Set the initial view

# Display the map
theme1_map

```

### RPL THEME 2

```{r}
#interactive map of RPL_THEME2

# Remove rows with -999 in the RPL_THEME2 column

ca_svi_sf_clean <- subset(ca_svi_sf, RPL_THEME2 != -999)


color_pal <- colorNumeric(
  palette = "magma", domain = ca_svi_sf_clean$RPL_THEME2
)

theme2_map <- leaflet() %>%
  addTiles() %>%
  addPolygons(data = ca_svi_sf_clean,
              fillColor = ~color_pal(RPL_THEME2),
              fillOpacity = 0.5,
              color = "black",
              weight = 1,
              popup = ~as.character(RPL_THEME2)) %>%
  setView(lng = -119.417931, lat = 36.778261, zoom = 6)  # Set the initial view

# Display the map
theme2_map

```

### RPL THEME 3

```{r}
#interactive map of RPL_THEME3

# Remove rows with -999 in the RPL_THEME3 column

ca_svi_sf_clean <- subset(ca_svi_sf, RPL_THEME3 != -999)


color_pal <- colorNumeric(
  palette = "Reds", domain = ca_svi_sf_clean$RPL_THEME3
)


theme3_map <- leaflet() %>%
  addTiles() %>%
  addPolygons(data = ca_svi_sf_clean,
              fillColor = ~color_pal(RPL_THEME3),
              fillOpacity = 0.5,
              color = "black",
              weight = 1,
              popup = ~as.character(RPL_THEME3)) %>%
  setView(lng = -119.417931, lat = 36.778261, zoom = 6)  # Set the initial view

# Display the map
theme3_map

```

### RPL THEME 4

```{r}
#interactive map of RPL_THEME4

# Remove rows with -999 in the RPL_THEME4 column

ca_svi_sf_clean <- subset(ca_svi_sf, RPL_THEME4 != -999)


color_pal <- colorNumeric(
  palette = "RdPu", domain = ca_svi_sf_clean$RPL_THEME4
)

theme3_map <- leaflet() %>%
  addTiles() %>%
  addPolygons(data = ca_svi_sf_clean,
              fillColor = ~color_pal(RPL_THEME4),
              fillOpacity = 0.5,
              color = "black",
              weight = 1,
              popup = ~as.character(RPL_THEME3)) %>%
  setView(lng = -119.417931, lat = 36.778261, zoom = 6)  # Set the initial view

# Display the map
theme3_map

```

