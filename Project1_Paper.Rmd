---
title: "Project 1:Write Up"
author: "Likhitha, Paulina, Shrihan"
date: "`r Sys.Date()`"
output:
  html_document:
    theme: cosmo
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: 
      collapsed: false
      smooth_scroll: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)
options(scientific=T, digits = 3) 
library(ezids)
library(ggplot2)
#install.packages("tigris")
library(tigris)
#install.packages("sf")
library(sf)
#install.packages("here")
library(here)
#install.packages("dplyr")
library(dplyr)
#install.packages("leaflet")
library(leaflet)
#install.packages("reshape2")
library(reshape2)
#install.packages("tmap")
library(tmap)
#install.packages("viridis")
library(viridis)
#install.packages("stargazer")
library(stargazer)
```

## Introduction

### Research Topic 
The aim of the project was to identify areas of vulnerability for different demographic groups at the census tract level by examining trends in the variables comprising the Social Vulnerability Index (SVI) created by the CDC. SMART questions were identified to narrow the scope of the project. The project sought to address a series of questions, all attempting to identify if there was any correlation between individual census variables and the compiled Thematic SVI scores, to illuminate any possible underrepresented groups across the indexes. 

**1**: Does breaking down the SVI by different demographics, such as elderly populations, minority group populations, sex, income impact the vulnerability scores of the census tracts?

**2**: Is there significance in identifying areas of population vulnerability based on different demographics compared to the overall population of each tract? 

**3**: Do specific demographics’ vulnerability ratings have a higher impact on the overall SVI score of the census tract? 
Can we visualize the different vulnerability scores based on demographic in an impactful way for public health officials and emergency planners? 

**4**: With the available data and resources (R scripting and visualizations), is it possible to conduct this analysis within the class project deadlines? 

**5**: Can we provide relevant/significant findings to public health and emergency planning officials (in terms of emergency response and social justice issues)? 

### Social Vulnerability Index (SVI) 

According to the [CDC](https://www.atsdr.cdc.gov/placeandhealth/svi/index.html), social vulnerability defines the potential negative effects on communities caused by external stresses on human health. These stresses can be events like natural disasters, disease outbreaks, or human-caused events. 
To address social vulnerability, the CDC has compiled the SVI as a tool to help public health officials and emergency response planners identify communities that may need support before, during, or after disasters. It is provided at the state, county, and census tract level. It is comprised of 16 census variables. 
By assessing trends in the variables used to create the SVI, the project will examine how splitting the population by different demographics such as race or age affects each census tract’s vulnerability across the 5 compiled themes. This could help identify if there are systemic injustices or inequities, as well as where different vulnerable groups are located. 


## Data Set and Variables 

### SVI Data 
The SVI is comprised of 5 total SVI calculations: 4 thematic and 1 overall summary composed by the sum of the themes. 

**Socioeconomic Status**: `RPL_THEME1`

* Below 150% Poverty

* Unemployed

* Housing Cost Burden

* No High School Diploma

* No Health Insurance

**Household Characteristics**: `RPL_THEME2`

* Aged 65 & Older
 
* Aged 17 & Younger	

* Civilian with a Disability

* Single-Parent Households

* English Language Proficiency


**Racial & Ethnic Minority Status**:`RPL_THEME3`

* Hispanic or Latino (of any race); Black and African American, Not Hispanic or Latino; American Indian and Alaska Native, Not Hispanic or Latino; Asian, Not Hispanic or Latino; Native Hawaiian and Other Pacific Islander, Not Hispanic or Latino; Two or More Races, Not Hispanic or Latino; Other Races, Not Hispanic or Latino

**Housing Type & Transportation**: `RPL_THEME4`

* Multi-Unit Structures

* Mobile Homes

* Crowding

* No Vehicle

* Group Quarters

**Overall**: `RPL_THEMES`

* CDC then sums the sums for each theme, orders the tracts, and then calculates overall percentile rankings. 

## Clean the Data

**Load the data file**

```{r Load the data file, echo=T, results='hide'}
SVI_Data <- read.csv("SVI_2020_US.csv")
head(SVI_Data)
```

**Keep relevant columns**

```{r select columns, echo=T, results='hide'}

#selecting the required columns by subset function

Clean_data <- subset(SVI_Data, select = c(ST,STATE,ST_ABBR,STCNTY,COUNTY,FIPS,LOCATION,AREA_SQMI,EPL_POV150,	EPL_UNEMP,	EPL_HBURD,	EPL_NOHSDP,	EPL_UNINSUR,	SPL_THEME1,	RPL_THEME1,	EPL_AGE65,	EPL_AGE17,	EPL_DISABL,	EPL_SNGPNT,	EPL_LIMENG,	SPL_THEME2,	RPL_THEME2,	EPL_MINRTY,	SPL_THEME3,	RPL_THEME3, E_MINRTY, EP_HISP, EP_ASIAN, EP_AIAN, EPL_MUNIT,	EPL_MOBILE,	EPL_CROWD,	EPL_NOVEH,	EPL_GROUPQ,	SPL_THEME4,	RPL_THEME4,	SPL_THEMES,	RPL_THEMES, E_AGE65, EP_POV150, EP_AGE65, EP_NOHSDP
) )

head(Clean_data)


```

**Subset to just CA tracts** 
```{r CA tracts, echo=T, results='hide'}
CA_SVI <- subset(Clean_data, ST_ABBR == "CA")
```


## Outliers {.tabset}

### RPL_THEME1

```{r Outliers}
Outliers1 = outlierKD2(CA_SVI, RPL_THEME1, rm = FALSE, qqplt = TRUE)
```

### RPL_THEME2

```{r}
Outliers2 = outlierKD2(CA_SVI, RPL_THEME2, rm = FALSE, qqplt = TRUE)
```

### RPL_THEME3

```{r}
Outliers3 = outlierKD2(CA_SVI, RPL_THEME3, rm = FALSE, qqplt = TRUE)

```

### RPL_THEME4

```{r}
Outliers4 = outlierKD2(CA_SVI, RPL_THEME4, rm = FALSE, qqplt = TRUE)
```

### RPL_THEMES

```{r}
Outliers = outlierKD2(CA_SVI, RPL_THEMES, rm = FALSE, qqplt = TRUE)
```

### Explanation

Here it is seen that there is a large number of missing values, represented by `-999`, but the number of missing values does not equal the number of outliers identified. Thus, for the purposes of our analysis the missing values values were removed, but the outliers were not removed, to identify any particular at risk census tracts (if the SVI is unusually low or high compared to the others is still significant and interesting to examine). 
 
**RPL_THEMES**
```{r}
count <- sum(CA_SVI$RPL_THEMES == -999)
count1 <- sum(CA_SVI$RPL_THEME1 == -999) 
count2 <- sum(CA_SVI$RPL_THEME2 == -999) 
count3 <- sum(CA_SVI$RPL_THEME3 == -999)
count4 <- sum(CA_SVI$RPL_THEME4 == -999)
```

* There are `r count` missing values in `RPL_THEMES`

* There are `r count1` missing values in `RPL_THEME1`

* There are `r count2` missing values in `RPL_THEME2`

* There are `r count3` missing values in `RPL_THEME3`

* There are `r count4` missing values in `RPL_THEME4`

## {-}


## Data Analysis {.tabset .tabset-fade .tabset-pills}

### Maps
It is interesting to examine the spatial distribution of this dataset, given that it looks across census tracts, a geographic scale. This portion of the analysis examines the spatial distribution of SVI and demographic variables.

First the data had to be prepped for spatial analysis.
*Note, when conducting the spatial join between `ca_tracts` and `CA_SVI`, there were 20 tracts present in `ca_tracts` not identified in `CA_SVI`.*

```{r echo=T, results='hide'}
#Load 2020 Census Tract shapefile for California
ca_tracts <- tracts(state = "CA", year = 2020)

#add 0 to FIPS variable in CA_SVI to merge with ca_tracts (on GEOID)
CA_SVI$FIPS <- paste0("0", CA_SVI$FIPS)

#Join CA_SVI and ca_tracts based on FIPS and GEOID
CA_SVI <- inner_join(CA_SVI, ca_tracts, by = c("FIPS" = "GEOID"))

#for mapping, convert CA_SVI to a Simple Features (map object)
ca_svi_sf <- st_as_sf(CA_SVI)

#remove missing values from our variables:
ca_svi_sf_clean <- subset(ca_svi_sf, RPL_THEME1 != -999)
ca_svi_sf_clean <- subset(ca_svi_sf, RPL_THEME2 != -999)
ca_svi_sf_clean <- subset(ca_svi_sf, RPL_THEME3 != -999)
ca_svi_sf_clean <- subset(ca_svi_sf, RPL_THEME4 != -999)
ca_svi_sf_clean <- subset(ca_svi_sf, RPL_THEMES != -999)


```

#### Maps {.tabset .tabset-fade .tabset-pills}

##### RPL_THEMES

```{r}

ggplot(data = ca_svi_sf_clean) +
  geom_sf(aes(fill = RPL_THEMES)) +
  scale_fill_viridis(option = "D", direction = 1) +
  labs(title = "Overall SVI Score by CA Census Tracts") +
  theme_void()+
  theme(text = element_text(family = "Avenir"))
<<<<<<< Updated upstream
<<<<<<< Updated upstream

=======
<<<<<<< Updated upstream
map0 
=======
map0
>>>>>>> Stashed changes
>>>>>>> Stashed changes
=======
map0 
>>>>>>> Stashed changes
```

##### RPL_THEME1

```{r}
<<<<<<< Updated upstream
<<<<<<< Updated upstream
=======
map1 = 
<<<<<<< Updated upstream
>>>>>>> Stashed changes
ggplot(data = ca_svi_sf_clean) +
=======
=======

map1 = 
>>>>>>> Stashed changes
  ggplot(data = ca_svi_sf_clean) +
  geom_sf(aes(fill = RPL_THEME1)) +
  scale_fill_viridis(option = "D", direction = 1) +
  labs(title = "Theme 1 (Socioeconomic Status) SVI Score by CA Census Tracts") +
  theme_void()+
  theme(text = element_text(family = "Avenir"))


```

##### RPL_THEME2
```{r}
<<<<<<< Updated upstream
<<<<<<< Updated upstream
=======
map2 = 
<<<<<<< Updated upstream
>>>>>>> Stashed changes
=======

map2 = 

>>>>>>> Stashed changes
ggplot(data = ca_svi_sf_clean) +
  geom_sf(aes(fill = RPL_THEME2)) +
  scale_fill_viridis(option = "D", direction = 1) +
  labs(title = "Theme 2 (Household Characteristics) SVI Score by CA Census Tracts") +
  theme_void()+
  theme(text = element_text(family = "Avenir"))

```

##### RPL_THEME3
```{r}

ggplot(data = ca_svi_sf_clean) +
  geom_sf(aes(fill = RPL_THEME3)) +
  scale_fill_viridis(option = "D", direction = 1) +
  labs(title = "Theme 3 (Racial & Ethnic Minority Status) SVI Score by CA Census Tracts") +
  theme_void()+
  theme(text = element_text(family = "Avenir"))


```

##### RPL_THEME4

```{r}
<<<<<<< Updated upstream
<<<<<<< Updated upstream
ggplot(data = ca_svi_sf_clean) +
=======
<<<<<<< Updated upstream
map4 = ggplot(data = ca_svi_sf_clean) +
=======

map4 =
  ggplot(data = ca_svi_sf_clean) +
>>>>>>> Stashed changes
>>>>>>> Stashed changes
=======
map4 =
  ggplot(data = ca_svi_sf_clean) +
>>>>>>> Stashed changes
  geom_sf(aes(fill = RPL_THEME4)) +
  scale_fill_viridis(option = "D", direction = 1) +
  labs(title = "Theme 4 (Housing Type & Transportation) SVI Score by CA Census Tracts") +
  theme_void()+
  theme(text = element_text(family = "Avenir"))
<<<<<<< Updated upstream
<<<<<<< Updated upstream
=======
<<<<<<< Updated upstream
=======

>>>>>>> Stashed changes
map4
```
>>>>>>> Stashed changes

```
=======
map4
```
>>>>>>> Stashed changes

### Histogram

#### Histograms {.tabset .tabset-fade .tabset-pills}

##### HISTOGRAM #1

##### HISTOGRAM #2

##### HISTOGRAM #3

### Scatterplots 

#### Scatterplots {.tabset .tabset-fade .tabset-pills}

##### Scatterplots #1

##### Scatterplots #2

##### Scatterplots #3


### Correlation Heatmap


### Hypothesis Testing

#### Hypothesis Tests {.tabset .tabset-fade .tabset-pills}

##### RPL_THEMES and RPL_THEME1
```{r}
t_test_result1 <- t.test(CA_SVI$RPL_THEMES, CA_SVI$RPL_THEME1)

# Create a nicely formatted table
stargazer(t_test_result1, type = "text")

```


##### RPL_THEMES and RPL_THEME2
```{r}
t_test_result2 <- t.test(CA_SVI$RPL_THEMES, CA_SVI$RPL_THEME2)

# Print the results
print(t_test_result2)
```

##### RPL_THEMES and RPL_THEME3
```{r}
t_test_result3 <- t.test(CA_SVI$RPL_THEMES, CA_SVI$RPL_THEME3)

# Print the results
print(t_test_result3)
```

##### RPL_THEMES and RPL_THEME4
```{r}
t_test_result4 <- t.test(CA_SVI$RPL_THEMES, CA_SVI$RPL_THEME4)

# Print the results
print(t_test_result4)
```


## Conclusion

## Future Work


